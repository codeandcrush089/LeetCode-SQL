# Problems 1747: Leetflex Banned Accounts

![Medium](https://img.shields.io/badge/Level-Medium-yellow)

```sql
WITH
  LogInfoNeighbors AS (
    SELECT
      *,
      LEAD(ip_address) OVER(
        PARTITION BY account_id
        ORDER BY login
      ) AS next_ip_address,
      LEAD(login) OVER(
        PARTITION BY account_id
        ORDER BY login
      ) next_login
    FROM LogInfo
  )
SELECT DISTINCT account_id
FROM LogInfoNeighbors
WHERE
  next_login <= logout
  AND ip_address != next_ip_address;
```

## ðŸ§ Query Explanation


* `WITH LogInfoNeighbors AS (...)` â†’ Creates a **temporary result (CTE)** with extra columns.
* `LEAD(ip_address)` â†’ Gets the **next loginâ€™s IP address** for the same account.
* `LEAD(login)` â†’ Gets the **next login time** for the same account.
* `PARTITION BY account_id` â†’ Applies LEAD **separately for each account**.
* `ORDER BY login` â†’ Ensures logins are checked **in time order**.
* `next_login <= logout` â†’ Checks if the **next login happened before logout** (overlapping sessions).
* `ip_address != next_ip_address` â†’ Ensures the **IP addresses are different**.
* `SELECT DISTINCT account_id` â†’ Returns **unique suspicious accounts only**.


