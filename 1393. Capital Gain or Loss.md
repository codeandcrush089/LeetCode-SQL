# Problem 1393: Capital Gain or Loss
![Medium](https://img.shields.io/badge/Level-Medium-yellow)

```sql

SELECT
    stock_name,
        SUM(
        CASE
            WHEN operation = 'Sell' THEN price
            WHEN operation = 'Buy' THEN -price
                        ELSE 0 
        END
    ) AS capital_gain_loss
FROM
    Stocks
GROUP BY
    stock_name
ORDER BY
    stock_name;
```

---

## üßê Query Explanation

### **1. `SELECT stock_name`**

Retrieves each distinct stock‚Äôs name.


### **2. Capital Gain/Loss Calculation**

```sql
SUM(
    CASE
        WHEN operation = 'Sell' THEN price
        WHEN operation = 'Buy' THEN -price
        ELSE 0
    END
) AS capital_gain_loss
```

* Uses **conditional aggregation**:

  * **Sell** ‚Üí adds the price (profit)
  * **Buy** ‚Üí subtracts the price (cost)
* Summing these over all rows per stock gives the **net gain/loss**.


### **3. `FROM Stocks`**

Reads data from the `Stocks` table, which contains:

* stock name
* operation (`Buy` / `Sell`)
* price


### **4. `GROUP BY stock_name`**

Groups all Buy/Sell operations for the **same stock**, allowing us to calculate the total gain/loss per stock.


### **5. `ORDER BY stock_name`**

Sorts results alphabetically by stock name (optional, but keeps output orderly).

