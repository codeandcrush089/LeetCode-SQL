# Problem 585: Investments in 2016
![Medium](https://img.shields.io/badge/Level-Medium-yellow)

```sql
SELECT
    
    ROUND(SUM(T.tiv_2016), 2) AS tiv_2016
FROM
    Insurance T
WHERE
    
    T.tiv_2015 IN (
        SELECT
            tiv_2015
        FROM
            Insurance
        GROUP BY
            tiv_2015
        HAVING
            COUNT(pid) > 1 -- Only select tiv_2015 values that appear at least twice
    )
    AND
    
    (T.lat, T.lon) IN (
        SELECT
            lat,
            lon
        FROM
            Insurance
        GROUP BY
            lat, lon
        HAVING
            COUNT(pid) = 1 -- Only select (lat, lon) pairs that appear exactly once
    );
```
---
## ðŸ§ Query Explanation

### **1. `FROM Insurance T`**

Uses the `Insurance` table as the base data.


### **2. Condition 1 â€“ Non-unique `tiv_2015`**

```sql
T.tiv_2015 IN (
    SELECT tiv_2015
    FROM Insurance
    GROUP BY tiv_2015
    HAVING COUNT(pid) > 1
)
```

* Groups records by `tiv_2015`.
* Keeps only those `tiv_2015` values that appear **more than once**.
* Ensures the policyholderâ€™s `tiv_2015` is **not unique**.


### **3. Condition 2 â€“ Unique location (`lat`, `lon`)**

```sql
(T.lat, T.lon) IN (
    SELECT lat, lon
    FROM Insurance
    GROUP BY lat, lon
    HAVING COUNT(pid) = 1
)
```

* Groups records by geographic location.
* Keeps only locations that appear **exactly once**.
* Ensures the policyholderâ€™s location is **unique**.


### **4. Aggregate calculation**

```sql
SUM(T.tiv_2016)
```

Adds up the `tiv_2016` values of all records that satisfy both conditions.


### **5. `ROUND(..., 2)`**

Rounds the final sum to **2 decimal places**.

