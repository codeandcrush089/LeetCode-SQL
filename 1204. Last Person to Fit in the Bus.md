```sql
WITH RunningWeights AS (
    SELECT
        person_name,
        turn,
        
        SUM(weight) OVER (ORDER BY turn ASC) AS total_weight
    FROM
        Queue
)
SELECT
    person_name
FROM
    RunningWeights
WHERE
    total_weight <= 1000 
ORDER BY
    turn DESC 
LIMIT 1; 
```

## ðŸ§ Query Explanation


### 1. `WITH RunningWeights AS ( ... )`

Creates a **Common Table Expression (CTE)** named `RunningWeights` to store intermediate results with cumulative weights.


### 2. `SELECT person_name, turn, SUM(weight) OVER (ORDER BY turn ASC) AS total_weight`

* Selects:

  * `person_name`
  * `turn` (queue order)
* Calculates a **running (cumulative) total of weight** using a **window function**:

  * `SUM(weight) OVER (ORDER BY turn ASC)`
  * Adds weights in the order of `turn`.


### 3. `FROM Queue`

Uses the **Queue** table as the source data for the CTE.


### 4. `SELECT person_name FROM RunningWeights`

Fetches only the **person name** from the CTE.


### 5. `WHERE total_weight <= 1000`

Filters to keep only those people for whom the **cumulative queue weight does not exceed 1000**.


### 6. `ORDER BY turn DESC`

Sorts the remaining rows in **descending order of turn** so the **latest valid person** appears first.


### 7. `LIMIT 1`

Returns **only one row** â€” the **last person who can still enter without exceeding the 1000 weight limit**.


### âœ… Final Outcome

Returns the **name of the last person in the queue whose cumulative weight is within 1000**.

