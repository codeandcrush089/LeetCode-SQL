# Problem 1651: Hopper Company Queries III
![Hard](https://img.shields.io/badge/Level-Hard-red)

```sql
WITH RECURSIVE
  Calendar AS (
    SELECT 2 AS MONTH
    UNION ALL
    SELECT MONTH + 1
    FROM Calendar
    WHERE MONTH < 11
  )
SELECT
  Calendar.month - 1 AS MONTH,
  IFNULL(
    ROUND(
      (
        SELECT SUM(AcceptedRides.ride_distance)
        FROM Rides
        INNER JOIN AcceptedRides
          USING (ride_id)
        WHERE
          YEAR(Rides.requested_at) = '2020'
          AND MONTH(Rides.requested_at) IN (
            Calendar.month - 1,
            Calendar.month,
            Calendar.month + 1
          )
      ) / 3,
      2
    ),
    0
  ) AS average_ride_distance,
  IFNULL(
    ROUND(
      (
        SELECT SUM(AcceptedRides.ride_duration)
        FROM Rides
        INNER JOIN AcceptedRides
          USING (ride_id)
        WHERE
          YEAR(Rides.requested_at) = '2020'
          AND MONTH(Rides.requested_at) IN (
            Calendar.month - 1,
            Calendar.month,
            Calendar.month + 1
          )
      ) / 3,
      2
    ),
    0
  ) AS average_ride_duration
FROM Calendar;
```

## ðŸ§ Query Explanation

* `WITH RECURSIVE Calendar` â†’ Creates a list of months **2 to 11**.
* `Calendar.month - 1 AS month` â†’ Treats **1â€“10 as the â€œcenterâ€ month** of a 3-month window.
* `MONTH(requested_at) IN (month-1, month, month+1)` â†’ Picks rides from a **3-month range** around each center month.
* `SUM(ride_distance) / 3` â†’ Adds total distance for those 3 months and divides by **3 (months)** â†’ average **per month**.
* Same logic for `ride_duration`.
* `ROUND(..., 2)` â†’ Rounds to **2 decimal places**.
* `IFNULL(..., 0)` â†’ If no data, returns **0 instead of NULL**.

