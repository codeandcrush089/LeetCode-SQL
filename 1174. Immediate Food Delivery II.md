# Problem 1174: Immediate Food Delivery II
![Medium](https://img.shields.io/badge/Level-Medium-yellow)

```sql
SELECT
    -- Calculate the percentage: (Count of Immediate First Orders / Total Customers) * 100
    ROUND(
        SUM(CASE
            WHEN t1.order_date = t1.customer_pref_delivery_date THEN 1
            ELSE 0
        END) * 100.0 / COUNT(t1.customer_id)
    , 2) AS immediate_percentage
FROM
    Delivery t1
INNER JOIN
    (
        -- Subquery to find the earliest order date for each customer
        SELECT
            customer_id,
            MIN(order_date) AS first_order_date
        FROM
            Delivery
        GROUP BY
            customer_id
    ) AS t2
ON
    t1.customer_id = t2.customer_id AND t1.order_date = t2.first_order_date;
```


---
## üßê Query Explanation

### 1. Outer `SELECT` and `ROUND(...) AS immediate_percentage`

```sql
ROUND( ..., 2 ) AS immediate_percentage
```

* Calculates a **percentage value** and rounds it to **2 decimal places**.
* The result is named **`immediate_percentage`**.


### 2. `SUM(CASE WHEN t1.order_date = t1.customer_pref_delivery_date THEN 1 ELSE 0 END)`

* For each row:

  * Adds **1** if the **order date equals the preferred delivery date** ‚Üí this is an **immediate first order**.
  * Adds **0** otherwise.
* `SUM(...)` gives the **total number of immediate first orders**.


### 3. `COUNT(t1.customer_id)`

* Counts the **total number of first orders** (one per customer due to the join with first_order_date).


### 4. `SUM(...) * 100.0 / COUNT(...)`

* Computes:

  * **(Immediate First Orders / Total Customers) √ó 100**
* Gives the **percentage of customers whose first order was delivered on their preferred date**.


### 5. `FROM Delivery t1`

* Uses the **Delivery** table as `t1`, representing **individual delivery records**.

### 6. Subquery `t2`

```sql
SELECT
    customer_id,
    MIN(order_date) AS first_order_date
FROM Delivery
GROUP BY customer_id
```

* For each customer:

  * Finds their **earliest (first) order date**.
* Returns one row per customer:

  * `customer_id`
  * `first_order_date`.


### 7. `INNER JOIN ... ON t1.customer_id = t2.customer_id AND t1.order_date = t2.first_order_date`

* Joins `t1` with `t2` so that:

  * Only the **first order record** for each customer is kept.
* This ensures the calculation is done **only on each customer's first order**.
