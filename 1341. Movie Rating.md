# Problem 1341: Movie Rating
![Medium](https://img.shields.io/badge/Level-Medium-yellow?style=for-the-badge) [![Problem Link](https://img.shields.io/badge/LeetCode-Link-orange?style=for-the-badge&logo=leetcode)](https://leetcode.com/problems/movie-rating/description/)

```sql
SELECT
    results
FROM
    (
    -- 1. Find the user who rated the greatest number of movies
    SELECT
        U.name AS results,
        COUNT(MR.user_id) AS rating_count
    FROM
        Users U
    JOIN
        MovieRating MR ON U.user_id = MR.user_id
    GROUP BY
        U.user_id, U.name
    ORDER BY
        rating_count DESC, -- Primary sort: highest count first
        U.name ASC          -- Secondary sort: lexicographically smallest name in case of a tie
    LIMIT 1
    ) AS UserMaxRatings

UNION ALL

SELECT
    results
FROM
    (
    -- 2. Find the movie with the highest average rating in February 2020
    SELECT
        M.title AS results,
        AVG(MR.rating) AS average_rating
    FROM
        Movies M
    JOIN
        MovieRating MR ON M.movie_id = MR.movie_id
    WHERE
        -- Filter for reviews created in February 2020
        DATE_FORMAT(MR.created_at, '%Y-%m') = '2020-02'
    GROUP BY
        M.movie_id, M.title
    ORDER BY
        average_rating DESC, -- Primary sort: highest average rating first
        M.title ASC          -- Secondary sort: lexicographically smallest title in case of a tie
    LIMIT 1
    ) AS MovieMaxAverageRating;
```
---
## üßê Query Explanation

## üîπ **What the query returns**

It outputs **two rows**:

1. The **name of the user** who rated the most movies
2. The **title of the movie** with the highest average rating in **February 2020**

Both results are stacked using `UNION ALL`.



## üîπ **How it works**

### **1Ô∏è‚É£ First subquery ‚Üí User who rated the most movies**

* Joins `Users` with `MovieRating`
* Counts how many ratings each user has made
* Sorts:

  * Most ratings **first**
  * If tied ‚Üí **alphabetically smallest name**
* `LIMIT 1` ‚Üí picks exactly one user
* Returns the user's **name** as `results`



### **2Ô∏è‚É£ Second subquery ‚Üí Highest-rated movie in Feb 2020**

* Filters ratings to **2020-02**
* Joins `Movies` with `MovieRating`
* Calculates each movie‚Äôs **average rating for that month**
* Sorts:

  * Highest average rating first
  * If tied ‚Üí **alphabetically smallest title**
* `LIMIT 1` ‚Üí picks the top movie
* Returns the movie's **title** as `results`



## üîπ **Final Output**

`UNION ALL` simply stacks the two subquery results:

```
results
-------
<top user name>
<top movie title>
```

