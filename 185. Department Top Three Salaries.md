# Problem 185: Department Top Three Salaries
![Hard](https://img.shields.io/badge/Level-Hard-red)

```sql
WITH RankedEmployees AS (
    -- 1. Calculate the rank of the salary within each department.
    SELECT
        E.departmentId,
        E.name AS Employee,
        E.salary AS Salary,
        
        DENSE_RANK() OVER (
            PARTITION BY E.departmentId
            ORDER BY E.salary DESC
        ) AS salary_rank
    FROM
        Employee E
)
-- 2. Select the results where the rank is 3 or less and join with Department for the name.
SELECT
    D.name AS Department,
    RE.Employee,
    RE.Salary
FROM
    RankedEmployees RE
JOIN
    Department D ON RE.departmentId = D.id
WHERE
    RE.salary_rank <= 3
ORDER BY
    D.name, RE.Salary DESC;
```
---
## ðŸ§ Query Explanation

### **1. `RankedEmployees` CTE**

* Reads employees from the `Employee` table.
* Uses `DENSE_RANK()` **per department**, ordered by salary descending.
* Assigns the same rank to employees with the same salary.
* Ensures ranking is based on **unique salaries** (no gaps).


### **2. `salary_rank`**

```sql
DENSE_RANK() OVER (PARTITION BY departmentId ORDER BY salary DESC)
```

* Rank `1` â†’ highest salary in the department
* Rank `2` â†’ second highest **distinct** salary
* Rank `3` â†’ third highest **distinct** salary


### **3. Final SELECT + JOIN**

* Joins ranked employees with `Department` to get the department name.
* Selects:

  * Department name
  * Employee name
  * Salary


### **4. `WHERE salary_rank <= 3`**

* Keeps only the **top 3 unique salary levels** per department.
* Includes all employees tied at those salary levels.


### **5. `ORDER BY D.name, RE.Salary DESC`**

* Sorts by department name.
* Within each department, shows higher salaries first.

