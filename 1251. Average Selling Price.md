# Problem 1251: Average Selling Price
![Easy](https://img.shields.io/badge/Level-Easy-brightgreen?style=for-the-badge) [![Problem Link](https://img.shields.io/badge/LeetCode-Link-orange?style=for-the-badge&logo=leetcode)](https://leetcode.com/problems/average-selling-price/description/)

```sql
SELECT
    p.product_id,
    -- Calculate the weighted average price: SUM(Revenue) / SUM(Units)
    -- COALESCE handles products with 0 sales (where SUM(u.units) would be NULL), setting the price to 0.
    ROUND(
        COALESCE(
            CAST(SUM(p.price * u.units) AS DECIMAL) / SUM(u.units),
            0.00
        )
    , 2) AS average_price
FROM
    Prices p
LEFT JOIN
    UnitsSold u
    -- 1. Match on product ID
    ON p.product_id = u.product_id
    -- 2. Ensure the purchase date falls within the price period
    AND u.purchase_date BETWEEN p.start_date AND p.end_date
GROUP BY
    p.product_id;
```
---
## üßê Query Explanation


* `p.price * u.units` ‚Üí Calculates **revenue** for each sale during that price period.

* `SUM(p.price * u.units)` ‚Üí Total revenue for the product across all price periods.

* `SUM(u.units)` ‚Üí Total **units sold**.

* `SUM(revenue) / SUM(units)` ‚Üí **Weighted average price**, based on how many units were sold at each price.

* `COALESCE(..., 0.00)` ‚Üí If no units were sold (SUM = NULL), return **0**.

* `LEFT JOIN UnitsSold`

  * Keeps all price records, even if the product had no sales.
  * Includes only sales where the **purchase date is within the price‚Äôs start‚Äìend date range**.

* `GROUP BY p.product_id` ‚Üí One result per product.

